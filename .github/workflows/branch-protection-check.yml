name: ğŸ›¡ï¸ Branch Protection Status Check

# This workflow ensures all required checks pass before merging to main
on:
  pull_request:
    branches: [ main ]
  workflow_run:
    workflows: ["ğŸ§ª Continuous Integration"]
    types: [completed]

jobs:
  protection-check:
    name: ğŸ›¡ï¸ Branch Protection Check
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request' || (github.event_name == 'workflow_run' && github.event.workflow_run.conclusion == 'success')
    
    steps:
    - name: âœ… All checks passed
      run: |
        echo "âœ… All required checks have passed!"
        echo "ğŸ§ª Unit tests: âœ… PASSED"
        echo "ğŸ­ E2E tests: âœ… PASSED" 
        echo "ğŸ—ï¸ Build test: âœ… PASSED"
        echo "ğŸ” Type check: âœ… PASSED"
        echo ""
        echo "ğŸš€ This PR is ready to merge to main!"

  protection-fail:
    name: ğŸš« Branch Protection Fail
    runs-on: ubuntu-latest
    if: github.event_name == 'workflow_run' && github.event.workflow_run.conclusion == 'failure'
    
    steps:
    - name: âŒ Checks failed
      run: |
        echo "âŒ Required checks have failed!"
        echo "ğŸš« This PR cannot be merged to main until all tests pass."
        echo ""
        echo "Please fix the failing tests and try again."
        exit 1